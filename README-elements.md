# pegin into elements 

  # create the config files
  
  cat bitcoin.conf
  
    #テスト環境か?(testnet=3 or regtest=1)
    regtest=1

    #外部からのRPCを受け付けるか(1=受け付ける)
    server=1
    #外部からのRPCを受け付けるIPの範囲
    rpcallowip=0.0.0.0/0

    #RPCの接続設定
    rpcbind=0.0.0.0
    rpcuser=username
    rpcpassword=password
    rpcport=8340

    # すべてのトランザクションをインデックス化する場合はtxindex=1
    # それ以外の場合は自分のウォレットに関連するトランザクションのみインデックス化する。
    # インデックス化している場合のみgetrawtransactionなどでトランザクションの情報を取得できる。
    txindex=1

    #デーモンでの起動
    daemon=1

    # 接続ノード
    #addnode=

  cat elements.conf
    
    rpcuser=username
    rpcpassword=password
    rpcport=8339
    daemon=1
    discover=0
    testnet=0
    regtest=1
    mainchainhost=127.0.0.1
    mainchainrpcport=8340
    mainchainrpcuser=username
    mainchainrpcpassword=password
    validatepegin=1
    txindex=1
  
  # start services
  
    bitcoind
    elementsd
    
  # create key for federation script on pegin
  
    $ elements-cli getnewaddress
    CTEkpNvfKWD6XsboFC3q9Wzx6UzC3MA7697YfokBmXFgTfk9i6nULhQC9UeV6E2ujV4JBQ7hkK91CHGE
    
    $ elements-cli validateaddress CTEkpNvfKWD6XsboFC3q9Wzx6UzC3MA7697YfokBmXFgTfk9i6nULhQC9UeV6E2ujV4JBQ7hkK91CHGE
    {
      "isvalid": true,
      "address": "CTEkpNvfKWD6XsboFC3q9Wzx6UzC3MA7697YfokBmXFgTfk9i6nULhQC9UeV6E2ujV4JBQ7hkK91CHGE",
      "scriptPubKey": "76a91497f257c97abc2473b70c2aec5721e7dbf7fd1eab88ac",
      "confidential_key": "0229d6c0e4eb68108fc20b5f26cc88285f4049cd8d8fe883b16ae8e4ab1e52c18a",
      "unconfidential": "2doHAjmQRDUfDyhHyryAAzwdgX3WNgSHdy6",
      "ismine": true,
      "iswatchonly": false,
      "isscript": false,
      "pubkey": "035760e39484d925efbf385d08c00745083e0502522cb3307fec436c82b255d5ca",
      "iscompressed": true,
      "account": "",
      "timestamp": 1543974339,
      "hdkeypath": "m/0'/0'/1'",
      "hdmasterkeyid": "841a41ec9952d8f0be33aae25f8642c163dcf0ea"
    }

    $ elements-cli dumpprivkey CTEkpNvfKWD6XsboFC3q9Wzx6UzC3MA7697YfokBmXFgTfk9i6nULhQC9UeV6E2ujV4JBQ7hkK91CHGE
    cNaE78vQ3S6Fex74shyEjSPX6AJDMcDoQZDwjyiJXkdAfL2KoEmG
    
    $ elements-cli createmultisig 1 \[\"035760e39484d925efbf385d08c00745083e0502522cb3307fec436c82b255d5ca\"\]
    {
      "address": "XHUY3JBUFqXehUdeWK9BqpKEd82GZWQevU",
      "redeemScript": "5121035760e39484d925efbf385d08c00745083e0502522cb3307fec436c82b255d5ca51ae"
    }

    $ elements-cli stop
    Elements server stopping
    
    $ pwd
    /Users/cao/Library/Application Support/Bitcoin

    $ rm -rf elementsregtest

    $ elementsd -signblockscript=5121035760e39484d925efbf385d08c00745083e0502522cb3307fec436c82b255d5ca51ae -fedpegscript=5121035760e39484d925efbf385d08c00745083e0502522cb3307fec436c82b255d5ca51ae
    Elements server starting
    
    $ elements-cli importprivkey cNaE78vQ3S6Fex74shyEjSPX6AJDMcDoQZDwjyiJXkdAfL2KoEmG
    
  # create a new block
  
    $ elements-cli getnewblockhex
    000000201b7fc96914ac612dac457b24d91321c8b26f2188a6401a584104a8af060142b3c1a8d36b8c97f0186717fcd579398d30b52c795cfe6c9b1823f34e44216231d2a630075c01000000255121035760e39484d925efbf385d08c00745083e0502522cb3307fec436c82b255d5ca51ae00010200000001010000000000000000000000000000000000000000000000000000000000000000ffffffff03510101ffffffff0201c1089459672f69c21022b44b0c2fd9a29bbe3e766957542ed19675fcc1c3089901000000000000000000016a01c1089459672f69c21022b44b0c2fd9a29bbe3e766957542ed19675fcc1c3089901000000000000000000266a24aa21a9ed94f15ed3a62165e4a0b99699cc28b48e19cb5bc1b1f47155db62d63f1e047d45000000000000012000000000000000000000000000000000000000000000000000000000000000000000000000
    
    $ elements-cli signblock 000000201b7fc96914ac612dac457b24d91321c8b26f2188a6401a584104a8af060142b3c1a8d36b8c97f0186717fcd579398d30b52c795cfe6c9b1823f34e44216231d2a630075c01000000255121035760e39484d925efbf385d08c00745083e0502522cb3307fec436c82b255d5ca51ae00010200000001010000000000000000000000000000000000000000000000000000000000000000ffffffff03510101ffffffff0201c1089459672f69c21022b44b0c2fd9a29bbe3e766957542ed19675fcc1c3089901000000000000000000016a01c1089459672f69c21022b44b0c2fd9a29bbe3e766957542ed19675fcc1c3089901000000000000000000266a24aa21a9ed94f15ed3a62165e4a0b99699cc28b48e19cb5bc1b1f47155db62d63f1e047d45000000000000012000000000000000000000000000000000000000000000000000000000000000000000000000
    00473045022100b8c16bbe4925e0c28ac468f5ffc370ce317a1497faa030208d4cff32d9b24d4302202d9417a5b96ed9275d8b59c2db1945128c8deb00de59a4eaa6ec7ffaac4577a3

    $ elements-cli combineblocksigs 000000201b7fc96914ac612dac457b24d91321c8b26f2188a6401a584104a8af060142b3c1a8d36b8c97f0186717fcd579398d30b52c795cfe6c9b1823f34e44216231d2a630075c01000000255121035760e39484d925efbf385d08c00745083e0502522cb3307fec436c82b255d5ca51ae00010200000001010000000000000000000000000000000000000000000000000000000000000000ffffffff03510101ffffffff0201c1089459672f69c21022b44b0c2fd9a29bbe3e766957542ed19675fcc1c3089901000000000000000000016a01c1089459672f69c21022b44b0c2fd9a29bbe3e766957542ed19675fcc1c3089901000000000000000000266a24aa21a9ed94f15ed3a62165e4a0b99699cc28b48e19cb5bc1b1f47155db62d63f1e047d45000000000000012000000000000000000000000000000000000000000000000000000000000000000000000000 \[\"00473045022100b8c16bbe4925e0c28ac468f5ffc370ce317a1497faa030208d4cff32d9b24d4302202d9417a5b96ed9275d8b59c2db1945128c8deb00de59a4eaa6ec7ffaac4577a3\"\]
     {
      "hex":    "000000201b7fc96914ac612dac457b24d91321c8b26f2188a6401a584104a8af060142b3c1a8d36b8c97f0186717fcd579398d30b52c795cfe6c9b1823f34e44216231d2a630075c01000000255121035760e39484d925efbf385d08c00745083e0502522cb3307fec436c82b255d5ca51ae4900473045022100b8c16bbe4925e0c28ac468f5ffc370ce317a1497faa030208d4cff32d9b24d4302202d9417a5b96ed9275d8b59c2db1945128c8deb00de59a4eaa6ec7ffaac4577a3010200000001010000000000000000000000000000000000000000000000000000000000000000ffffffff03510101ffffffff0201c1089459672f69c21022b44b0c2fd9a29bbe3e766957542ed19675fcc1c3089901000000000000000000016a01c1089459672f69c21022b44b0c2fd9a29bbe3e766957542ed19675fcc1c3089901000000000000000000266a24aa21a9ed94f15ed3a62165e4a0b99699cc28b48e19cb5bc1b1f47155db62d63f1e047d45000000000000012000000000000000000000000000000000000000000000000000000000000000000000000000",
      "complete": true
    }

    $ elements-cli submitblock 000000201b7fc96914ac612dac457b24d91321c8b26f2188a6401a584104a8af060142b3c1a8d36b8c97f0186717fcd579398d30b52c795cfe6c9b1823f34e44216231d2a630075c01000000255121035760e39484d925efbf385d08c00745083e0502522cb3307fec436c82b255d5ca51ae4900473045022100b8c16bbe4925e0c28ac468f5ffc370ce317a1497faa030208d4cff32d9b24d4302202d9417a5b96ed9275d8b59c2db1945128c8deb00de59a4eaa6ec7ffaac4577a3010200000001010000000000000000000000000000000000000000000000000000000000000000ffffffff03510101ffffffff0201c1089459672f69c21022b44b0c2fd9a29bbe3e766957542ed19675fcc1c3089901000000000000000000016a01c1089459672f69c21022b44b0c2fd9a29bbe3e766957542ed19675fcc1c3089901000000000000000000266a24aa21a9ed94f15ed3a62165e4a0b99699cc28b48e19cb5bc1b1f47155db62d63f1e047d45000000000000012000000000000000000000000000000000000000000000000000000000000000000000000000 
    
    $ elements-cli getblockcount
    1
    
    $ elements-cli getblockhash 1
    e287d57329b7412e8f6004e858663053d123fb2503b8e9627099b4182d13e8fe
    
    $ elements-cli getblock e287d57329b7412e8f6004e858663053d123fb2503b8e9627099b4182d13e8fe
    {
      "hash": "e287d57329b7412e8f6004e858663053d123fb2503b8e9627099b4182d13e8fe",
      "confirmations": 1,
      "strippedsize": 371,
      "size": 412,
      "weight": 1525,
      "height": 1,
      "version": 536870912,
      "versionHex": "20000000",
      "merkleroot": "d2316221444ef323189b6cfe5c792cb5308d3979d5fc176718f0978c6bd3a8c1",
      "tx": [
        "d2316221444ef323189b6cfe5c792cb5308d3979d5fc176718f0978c6bd3a8c1"
      ],
      "time": 1543975078,
      "mediantime": 1543975078,
      "nTx": 1,
      "signblock_witness_asm": "0 3045022100b8c16bbe4925e0c28ac468f5ffc370ce317a1497faa030208d4cff32d9b24d4302202d9417a5b96ed9275d8b59c2db1945128c8deb00de59a4eaa6ec7ffaac4577a3",
      "signblock_witness_hex": "00473045022100b8c16bbe4925e0c28ac468f5ffc370ce317a1497faa030208d4cff32d9b24d4302202d9417a5b96ed9275d8b59c2db1945128c8deb00de59a4eaa6ec7ffaac4577a3",
      "previousblockhash": "b3420106afa80441581a40a688216fb2c82113d9247b45ac2d61ac1469c97f1b"
    }

  # pegin from bitcoin into elements
  
    $ elements-cli getpeginaddress
    {
      "mainchain_address": "2Mzkg7kHhSG2c9jFzkgRTN4MNYKaEr9N8ye",
      "claim_script": "00149c9c0a9cd0191f2289624ab8683109a085bc63e0"
    }

    $ bitcoin-cli getbalance
    0.00000000
    $ bitcoin-cli generate 101
    [
      "42aeeba41c1b5cda1371f6df873e4d81f2094faa53f37087169cb71a1384d8f6",
      "0987d6c85807de0d054d5a1d71d415da95cfafbd2b591f649d2fcba2682f0af3",
      "2e6050c922b872a31809e8ad289085f4c44eadb6acdd440baa2756bd6156e428",
      "1a1cdab211b90bf110ef53fc3941a11bd4de95ad678fb14ec4b371ef700a118b",
      "2ee81b6582e6ef7a531954d06f6847cb13a7887ce9cd43277e0a0d7a636fd5b6",
      "66e5423fb0c8246350754b50e6851e647402a9aeb8b4c481b7aa9f5fab3caff8",
      "77e1b87ded1bc8f6b1cdfe1d438a3ef7354e9317d81db926fe82747817f98441",
      "4fee3a1afc436bb7cf2643d02e1e77add486bf34adbba66bd4382056b6e0dfe8",
      "738fdb01dabd4ce27b27516c4e8994f5d94ae270fcc1b653c55eca0dda3fbec2",
      "6ad411a2f9bd550c87b7a056cded4cbce7b75c804b18782fb4dd2d9a79dd3cc5",
      "20f5022a8fde95f3f50a6d487a918de5c29723d5925778e3e70afeea7225d7e0",
      "08a7905701871bb8eede644406222302c73e310e8b3cb3ecbdda1257c55de9de",
      "25e4e100ad5c92833177439c32eefff69ae603d787bfd76970409b080437904c",
      "2441b68782d3784e9b77e6065984b8583b31038dba9c0686b06e90b838321648",
      "6887a908251493119b50af217452b9c67b07fe8774d8fd363e190ea13652c190",
      "2b5113788968130cd619be1138d09141b729188be6bb4f06f1d30b258f3e08f1",
      "5b4a1b9a60c4f19af34fcb45cabc9199539eded6fb8ad3632b19696790d4a839",
      "7391f9587200beac93331185d2cb2c518054323c790b1c688c21446240289797",
      "7ac7718971a082beb788a9a0a658a3c51e0989ffd9fbf5c40ecb3bb2a0197f96",
      "1c88f45a2e8170ab45f8d067fbd2b52fa0d184d7c4ba874402008391e88057c3",
      "715f27b7972b72ab96a3916709c55a5779d9025fd36c5aa6a77f45d4c298687e",
      "636e843eb935ca42fec891029f53a4fe42d4a854add9f69293d6633376fa0438",
      "1d8c62cba1081461f05b60a699dc80eccccc20007360cf71e33e1def7894de9d",
      "541751a195f34cdc12f4cc5d0f30227fde319048bc09e0ef88adafe085ba7fd4",
      "46c1dfe4aaa62177c71d99da88665b0fd00f69cf2502a0adb42678ac23b3a940",
      "0fceaac9d7bb0484af91fb3ee7dab3668be7815a551aa7ecfebb85da5e87293e",
      "796b5496c4faffc7214831bec732284f1b43e51b9caa793e5a9baa4f4d3d2850",
      "058658bd8376ec2a00d0666e092e24f3dcf16dbad324c366c56fb118c982e8ed",
      "39b290847b233493043a8350a8177ed9213196025a46430e19f65cc2dea3e03b",
      "4651de120dc9a05810867b1f331fe72dbbc69be8662076b061dd61a7055aeef4",
      "1b0b21bb391a78562b694211269dd50303fd488da548df43986520dc0142ad77",
      "6007d00deb38d94b01898f0f9effa5b72072f5aa856b5df3847e1f43eed0dd81",
      "1689605bce478ff8a944955fe77f7aa495186ad913867d70d1f629f82085a312",
      "0df9f57ea4e324220b0619daeedb35d0a331c63779f20d843bacbc451ce2569d",
      "1baea53428756a0419b5691a1df34b6723359c0721a0716fa1d4479cc4276227",
      "34418cc16b61ccf3aaf5728c62d9c84f0f1898d9c1ee93e195ca68132ea546e6",
      "703755fce020324b63b63d6d0e071c064fda1664110bcfad1f73b463bacbce18",
      "50899151b4e5e83ad6a99eb555c221d19b20e2c631656be9bc09f87172188104",
      "2e496483065c7c154357e1d8c65c93d24872b35f3d69f76a0bf2f718aeb9f7b3",
      "54ae29e2a98026213994acced6f6e3991c62a298744193a758be5fc7440192a9",
      "685b68c33e94ce5af2e1ba5a3e1798fc2499e9095b465844363f6311c6ac59a9",
      "17b9688f07ab6815b5f2a86cda47c2cc26933b560e6cd88a4e5921c29ad8c979",
      "3b816a31ac807cac960ba62f2f361e2828dd94fa56331ca5b1b363377630dedd",
      "0796bdc6207fbf1d1c1cbf808438a69bb79d2dedca0a006875135bed439ca6ea",
      "77e192d3c72e7a405b74631c16da4d08a9e457ff716e2f111dc058570f616dd8",
      "4b9d6a6974aab404e0d7fd6735e41d2537d2b7ea05533f75f53b231384a39ce8",
      "0ba88aab275804f2a998eecf15f60d6b1449b24628c76b978d0b52c7c7c7e7f4",
      "1ebcb2f0891d49061ab4626c337bd6709973123ee890dc0b49b0d3a1dbf37c38",
      "67bd257940336701d3cc3fa5b688bae1fcb216b5331a99918408fa8a739512c7",
      "67caeda93203aad10e50dd396f796d4bc068d522574772e9526bcaed2d4c7e1b",
      "32c1836effe42d618026c2f7cf62b1e669afe0475f66a64a9b07d22115b9b639",
      "6ff5abb8eb4cc705eca59388dd3f49bd01abee125a4dea836b2db7f49f7bc040",
      "4f6c887edc56e3cb3e6e5efb191db2c874a40623bb62b61afecbf8e1f1561139",
      "52efc0f82a29938d697c9aad6638f6ad2bce069b6069675deec6489b1460fd88",
      "012ed2a6f5490872a81e96dd0e88e78b79f63235a563612ea7bcf4505de8401b",
      "22804273a37b771e3f6baa0dec35073a9b8bf36c1653bf6131f17626af4d3b6c",
      "4128635860906983ae20cfd76b03a88565967efbec246d74f891eb6121ad9822",
      "6fe9d6ae14c4b2b53678f04c02d0183c732aa821762c625a38fdc5984ed28621",
      "4838c59b40a6a865ef4cfaf4557f0e9a9fe84b8de77041f87ce36990b914e36d",
      "34abe4bde83655fed335af5bf68b51b1221c702cee8e59570757e5ed41ea19fb",
      "20e8850392fe47f8f6b6395f1c173b55d954fb809918c332b69dda487dd29988",
      "7aaac32721ee5670f5ba838937e5819b723c27bcb3ad0a85ef1877746d8d885a",
      "7d4de7a885d4586b5b1c3ba84120a05f0d8772016a971a86f04e267d858873f7",
      "0ec0a22cb1271844fff9b2bc98d97421c0b1f895944c98631a7586d281e1ebac",
      "2ae07dd0a04b5555f2565e464c69d829545ed6cbc706594d57d7fca9f80f2fe1",
      "10803abc4e4c97ccef32b603e3a15066ef672580e4981e621809994bec10f61c",
      "7108af2c46aa918a415b77bb99864198c5d439515a4f87ba07abd22c1eaf86df",
      "5fb8796decaa27ddba64f6b383573df89b30a1b020372f801f58beec4bce8091",
      "71afae1e9d34e8d7dfcf1eada03c7625a6123ee18861343e88f409c7b912812b",
      "4fabff5856e11ba7ee002daf43087b8c1efc232af15b2fc9b750945b8d52c74e",
      "344968aa4dd7ee6063b428cbdf07cda523e656f238053f622e278eb9a1618d21",
      "1120c0e5ccfe1c98cf865f1fcaa818b427fe3f87a81dfaa8a19b375fcbaf3f5d",
      "39c60cd55f26b894e0e0266a57bed22f85700d2b36f147cbd631a94e35b35738",
      "24c13bf888959ac6430dff79fae53f267ed462deb44a7db6b48f40bc8cf3f02f",
      "1481362ae885abc413be1c6fd82760065c1a9c3ce18128b4e91e69ff9004165a",
      "33db0b77ecb0b66f9cac3b8239b8183e9c86bf6336af41a6eb0bf42176fc992a",
      "7f533e77f4bfc499e1ad2467c89993a9abdb0f58b47c97b9dec992d0dd96dbab",
      "675b51e245aef018dc1c6519824b1d11b8b36fae890ed8dfed6d5772ea78298d",
      "151c4e617cff15078f3587262134b3a5ab73c3385dff5670deb82277177e1a57",
      "5ad4e5df48da444e9dd38b07219d0c289f7d4832286f23fbb1fbbfc2c5d6474d",
      "4ebdb262df52ce7913410355746fe79ceb7af0bbed6123121c9a6922a3aed1d6",
      "71f02f8de7511dbae8da1a84990321b3c8bd4011d8c245b600c3ce74c581cc42",
      "17c1ff23d77ad86898702e83ec36f9730afae69b5c7313eee21d104944179185",
      "4665596624bc2ab80564dd7fe6a83a72cccad300561e285a802493dbd23f27d2",
      "51c9afa74d1be77d7e810a368cd17d84b636428be1aa971015f8f854999de5f7",
      "1076fb750525bbc4131b0732de981cb9923c13938e85a351ab37e239efe92f9e",
      "33561a51f2071ff94f2b4bfa21e8b4578b44da86c3419031d81ced853fe1c3ed",
      "6ca95db193729be284171300d615229de6b1e021c1f5be66f2b7831f838307df",
      "3a597e1b204a27156ecf37bceb42590f0a858415ec11a30b866e37686a73d168",
      "166f14a1a0ed8cf61fde3e0d5424532c2f98a237984ef45c507c68adc333527a",
      "033c4f015571e106ec808e35ea8205eb60072f175bf300931c24e9472aa9b847",
      "467564d7da80512debcdee09df6b2b82e37642c40356b634b885d5a71d7c96b0",
      "59df2d8589c6cc19179ebcd2434cb8f08bb60b71386cd200bcc1d66cf4889b04",
      "6b73ae29301b6fe221014929b43f1239aba9d7aa32d73418f152413ae4e421b0",
      "3d1235786fb0f8fc84397d16d2013b2a8727bd93149d191c771947eeba45c91d",
      "4a77a88c15a7b5293715964daef31029649770879a4016c7979b32ebf679ce6d",
      "7db05d11676aea9f3ddd1d5f57907a45ff42f0a5459a077f5e787f0aee72597d",
      "6a1ff5370a9113e193588ac877d1d59da72e69d14acb5d54ef7cea8c59c7bed4",
      "5703dcff1b94b3eccf0413f0e8e381123a5082b7037c9c0b3a8ca97c4381f2ae",
      "44dc1fc072c7d1559b9fcc490505a30aadcef4a63484b4d1f41a52343c6440a5",
      "5066de65b9fef8bb1c199e6da38966889a273d5de27c01a730de58b97897198c"
    ]
    $ bitcoin-cli getbalance
    50.00000000
    
    $ bitcoin-cli -regtest sendtoaddress "2Mzkg7kHhSG2c9jFzkgRTN4MNYKaEr9N8ye" 1
    65ff95c0e710e7f0799793c1fdae3091586fc0eecc95b2442050e75549ec1b6a
    
    # in order to get coin pegged, it is neccesary to run claimpegin
    # there are three parameters
    #  bitcoinTx
    #  txoutproof
    #  claim_script(option)
    
    $ bitcoin-cli generate 1
    [
      "42641ac9ba64a50c0917aa9e73fbedfb307bccf433c318a86def458f06e55a43"
    ]

    $ bitcoin-cli getrawtransaction 65ff95c0e710e7f0799793c1fdae3091586fc0eecc95b2442050e75549ec1b6a
    020000000131a3f328c54ee37ce632515c001b90c986b3f47948e78de4e0fa2c23c903db7c0000000049483045022100d3e537d40b7ccbc23eca351817c6d7075839da89871a35b839a4e9608141d1c5022075eababbb0aa7fc5da91ec7cfab0c3e17810e35afbd37a31be22153cd3e4ae5901feffffff0200e1f5050000000017a914525ac126d2bac506709847f5cf27e800bec8fe3d87500210240100000017a9140a7bb51d22a19a33153cc43f82c8f5815057a3468765000000

    $ bitcoin-cli gettxoutproof \[\"65ff95c0e710e7f0799793c1fdae3091586fc0eecc95b2442050e75549ec1b6a\"\]
    000000208c199778b958de30a7017ce25d3d279a886689a36d9e191cbbf8feb965de6650118ea658cb3c98d91906dbf69baa993f952e172557bde91779b8742291b6138b4136075cffff7f20020000000200000002d621002d5c6e54b1047bd06dcc54a911bffb899ce270e44369d1b326d0966e6b6a1bec4955e7502044b295cceec06f589130aefdc1939779f0e710e7c095ff650105

    


        elementsd 
        elementsd
